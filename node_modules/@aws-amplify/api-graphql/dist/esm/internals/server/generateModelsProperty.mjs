import { graphQLOperationsInfo } from '../APIClient.mjs';
import { listFactory } from '../operations/list.mjs';
import { indexQueryFactory } from '../operations/indexQuery.mjs';
import { getFactory } from '../operations/get.mjs';
import { getSecondaryIndexesFromSchemaModel } from '../clientUtils.mjs';

function generateModelsProperty(client, params) {
    const models = {};
    const config = params.config;
    const useContext = params.amplify === null;
    if (!config) {
        throw new Error('generateModelsProperty cannot retrieve Amplify config');
    }
    if (!config.API?.GraphQL) {
        return {};
    }
    const modelIntrospection = config.API.GraphQL.modelIntrospection;
    if (!modelIntrospection) {
        return {};
    }
    const SSR_UNSUPORTED_OPS = [
        'ONCREATE',
        'ONUPDATE',
        'ONDELETE',
        'OBSERVE_QUERY',
    ];
    for (const model of Object.values(modelIntrospection.models)) {
        const { name } = model;
        models[name] = {};
        Object.entries(graphQLOperationsInfo).forEach(([key, { operationPrefix }]) => {
            const operation = key;
            // subscriptions are not supported in SSR
            if (SSR_UNSUPORTED_OPS.includes(operation))
                return;
            if (operation === 'LIST') {
                models[name][operationPrefix] = listFactory(client, modelIntrospection, model, useContext);
            }
            else {
                models[name][operationPrefix] = getFactory(client, modelIntrospection, model, operation, useContext);
            }
        });
        const secondaryIdxs = getSecondaryIndexesFromSchemaModel(model);
        for (const idx of secondaryIdxs) {
            models[name][idx.queryField] = indexQueryFactory(client, modelIntrospection, model, idx);
        }
    }
    return models;
}

export { generateModelsProperty };
//# sourceMappingURL=generateModelsProperty.mjs.map
